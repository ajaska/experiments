{"mappings":"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","sources":["./src/rain/index.ts","./src/rain/sketch.ts"],"sourcesContent":["import p5 from \"p5\";\n\nimport { setup, updateState, draw, State } from \"./sketch\";\n\nnew p5((sketch) => {\n  let state: State;\n\n  sketch.setup = () => {\n    state = setup(sketch);\n    state.p5 = sketch;\n  };\n\n  sketch.draw = () => {\n    updateState(state);\n    draw(sketch, state);\n  };\n}, document.getElementById(\"p5canvas\")!);\n","import p5 from \"p5\";\n\n// @ts-ignore\np5.disableFriendlyErrors = true;\n\ninterface Drop {\n  x: number;\n  y: number;\n  v: number;\n\n  selected: boolean;\n  splattering: number;\n}\n\nenum Mode {\n  INTRO = 1,\n  SELECT,\n  STORY,\n  DOWNPOUR,\n}\n\nexport interface State {\n  p5: p5;\n  rain: Drop[];\n  mode: Mode;\n}\n\nlet X_DIM = window.innerWidth;\nlet Y_DIM = window.innerHeight - 4;\n\n// Mobile perf hacks\nif (Y_DIM > 1024 && Y_DIM > X_DIM) {\n  X_DIM = (1024 / Y_DIM) * X_DIM;\n  Y_DIM = 1024;\n}\n\nconst NOT_SPLATTERING = 999;\nconst MAX_SPLATTER = 10;\n\nconst goodbye = () => {\n  localStorage.setItem(\"x\", \"1\");\n};\nconst i_said_goodbye = () => {\n  return localStorage.getItem(\"x\");\n};\n\nexport function setup(sketch: p5): State {\n  const canvas = sketch.createCanvas(X_DIM, Y_DIM).elt;\n  canvas.style.width = \"100%\";\n  canvas.style.height = \"100%\";\n\n  let raindrops = 20;\n  let mode = Mode.INTRO;\n  let v = 1;\n  if (i_said_goodbye()) {\n    raindrops = 300;\n    mode = Mode.DOWNPOUR;\n    v = 4;\n  } else {\n    const t = document.getElementById(\"text\")!;\n    t.innerText = \"It is raining...\";\n    t.className = \"text fade-in\";\n  }\n\n  const drops = Array<Drop>(raindrops)\n    .fill({} as Drop)\n    .map((_) => ({\n      x: Math.random() * X_DIM,\n      y: Math.random() * Y_DIM,\n      v,\n      selected: false,\n      splattering: NOT_SPLATTERING,\n    }));\n\n  return { p5: sketch, rain: drops, mode };\n}\n\nexport function updateState(state: State): void {\n  let time_scale = 1;\n  switch (state.mode) {\n    case Mode.INTRO: {\n      // time_scale = 2;\n      break;\n    }\n    case Mode.SELECT: {\n      time_scale = 0.1;\n      break;\n    }\n    case Mode.STORY: {\n      time_scale = 0;\n      break;\n    }\n    case Mode.DOWNPOUR: {\n      break;\n    }\n  }\n\n  const accel = 0.01;\n  const terminal_velocity = 5;\n\n  for (const drop of state.rain) {\n    // Normal mode\n    if (drop.splattering === NOT_SPLATTERING) {\n      drop.y += drop.v * time_scale;\n      const jitter = (0.5 - Math.random()) * 0.01; // -0.005 to 0.005\n      drop.v = Math.min(\n        drop.v + (accel + jitter) * time_scale,\n        terminal_velocity\n      );\n\n      // 60% chance to splat after a certain point\n      if (drop.y > Y_DIM - 80 && Math.random() < 0.6) {\n        drop.splattering = MAX_SPLATTER;\n        // Force it if it goes too far\n      } else if (drop.y > Y_DIM - 20) {\n        drop.splattering = MAX_SPLATTER;\n      }\n\n      // Splatter mode\n    } else {\n      drop.splattering -= 1 * time_scale;\n    }\n  }\n\n  state.rain = state.rain.filter((drop) => drop.splattering > 0);\n\n  if (state.mode !== Mode.DOWNPOUR) {\n    if (Math.random() < 0.2 * time_scale) {\n      state.rain.push({\n        x: Math.random() * X_DIM,\n        y: Math.random() * 10,\n        v: 1,\n        selected: false,\n        splattering: NOT_SPLATTERING,\n      });\n    }\n  } else {\n    for (let i = 0; i < 2; i++) {\n      state.rain.push({\n        x: Math.random() * X_DIM,\n        y: Math.random() * 10,\n        v: 4,\n        selected: false,\n        splattering: NOT_SPLATTERING,\n      });\n    }\n  }\n\n  if (state.p5.frameCount === 60 * 3) {\n    const t = document.getElementById(\"text\")!;\n    t.className = \"text fade-out\";\n  }\n\n  if (state.p5.frameCount > 60 * 5 && state.mode === Mode.INTRO) {\n    state.mode = Mode.SELECT;\n\n    const t = document.getElementById(\"text\")!;\n    t.innerText = \"Choose your raindrop\";\n    t.className = \"text fade-in\";\n\n    state.p5.mouseClicked = () => {\n      const x = state.p5.mouseX;\n      const y = state.p5.mouseY;\n      const maybeDrop = state.rain.find(\n        (drop) => Math.abs(x - drop.x) < 8 && Math.abs(y - drop.y) < 8\n      );\n      if (maybeDrop) {\n        maybeDrop.selected = true;\n        state.mode = Mode.STORY;\n        state.p5.mouseClicked = () => {}\n\n        // Animations\n        t.className = \"text fade-out\";\n        setTimeout(() => {\n          t.innerText = \"This is your raindrop.\";\n          t.className = \"text fade-in\";\n        }, 1000);\n        setTimeout(() => {\n          t.className = \"text fade-out\";\n        }, 4000);\n        setTimeout(() => {\n          t.innerText = \"Please keep an eye on it, and take good care of it.\";\n          t.className = \"text fade-in\";\n        }, 5000);\n        setTimeout(() => {\n          t.className = \"text fade-out\";\n        }, 8000);\n        setTimeout(() => {\n          t.innerText = \"You won't be getting another one.\";\n          t.className = \"text fade-in\";\n        }, 9000);\n        setTimeout(() => {\n          t.className = \"text fade-out\";\n        }, 12000);\n        setTimeout(() => {\n          state.mode = Mode.DOWNPOUR;\n          goodbye();\n        }, 13000);\n      }\n      return false;\n    };\n  }\n}\n\nexport function draw(sketch: p5, state: State) {\n  sketch.background(64, 64, 64);\n  let pointerCursor = false;\n  const selectable = state.mode === Mode.SELECT;\n  for (const drop of state.rain) {\n    if (drop.splattering === NOT_SPLATTERING) {\n      sketch.strokeWeight(2);\n      sketch.stroke(180, 180, 230);\n      sketch.point(drop.x, drop.y);\n\n      const tailLength = Math.round(drop.v * 2.5);\n      for (let i = 0; i < tailLength; i++) {\n        sketch.stroke(\n          180 + 10 * (i + 1),\n          180 + 10 * (i + 1),\n          230 + 5 * (i + 1)\n        );\n        sketch.point(drop.x, drop.y - i);\n      }\n\n      // Selection logic\n      if (drop.selected && state.mode !== Mode.DOWNPOUR) {\n        sketch.strokeWeight(2);\n        sketch.stroke(\"#FF0000\");\n        sketch.noFill();\n        sketch.circle(drop.x, drop.y - tailLength / 2, 24);\n      } else if (\n        selectable &&\n        Math.abs(sketch.mouseX - drop.x) < 8 &&\n        Math.abs(sketch.mouseY - drop.y) < 8\n      ) {\n        sketch.strokeWeight(1);\n        sketch.stroke(\"#FF8888\");\n        sketch.noFill();\n        sketch.circle(drop.x, drop.y - tailLength / 2, 24);\n        pointerCursor = true;\n      }\n    } else {\n      // Splatters\n      sketch.strokeWeight(1);\n      sketch.stroke(180, 180, 230);\n      const angles = [\n        { dx: -0.7, dy: 0.7 },\n        { dx: 0, dy: 1 },\n        { dx: 0.7, dy: 0.7 },\n      ];\n      for (const angle of angles) {\n        const { dx, dy } = angle;\n        sketch.point(\n          drop.x + dx * (MAX_SPLATTER - drop.splattering),\n          drop.y - dy * (MAX_SPLATTER - drop.splattering)\n        );\n      }\n    }\n  }\n\n  if (pointerCursor && selectable) {\n    sketch.cursor(\"pointer\");\n  } else {\n    sketch.cursor(\"default\");\n  }\n\n  return state;\n}\n"],"names":["_p","require","_sketch","p5","sketch","state","setup","draw","updateState","document","getElementById","Mode","canvas","createCanvas","X_DIM","Y_DIM","elt","style","width","height","raindrops","mode","INTRO","v","localStorage","getItem","DOWNPOUR","t","innerText","className","drops","Array","fill","map","_","x","Math","random","y","selected","splattering","rain","time_scale","SELECT","STORY","drop","jitter","min","filter","push","i","frameCount","mouseClicked","mouseX","mouseY","maybeDrop","find","abs","setTimeout","setItem","background","pointerCursor","selectable","strokeWeight","stroke","point","tailLength","round","noFill","circle","angles","dx","dy","angle","cursor","disableFriendlyErrors","window","innerWidth","innerHeight"],"version":3,"file":"index.38882aeb.js.map"}