!function(){var e,t,n,r;window.SuperGif=(e=function(e){return e.reduce((function(e,t){return 2*e+t}),0)},t=function(e){for(var t=[],n=7;n>=0;n--)t.push(!!(e&1<<n));return t},n=function(e){this.data=e,this.len=this.data.length,this.pos=0,this.readByte=function(){if(this.pos>=this.data.length)throw new Error("Attempted to read past end of stream.");return e instanceof Uint8Array?e[this.pos++]:255&e.charCodeAt(this.pos++)},this.readBytes=function(e){for(var t=[],n=0;n<e;n++)t.push(this.readByte());return t},this.read=function(e){for(var t="",n=0;n<e;n++)t+=String.fromCharCode(this.readByte());return t},this.readUnsigned=function(){var e=this.readBytes(2);return(e[1]<<8)+e[0]}},r=function(n,r){r||(r={});var a=function(e){for(var t=[],r=0;r<e;r++)t.push(n.readBytes(3));return t},i=function(){var e,t;t="";do{e=n.readByte(),t+=n.read(e)}while(0!==e);return t},o=function(o){o.leftPos=n.readUnsigned(),o.topPos=n.readUnsigned(),o.width=n.readUnsigned(),o.height=n.readUnsigned();var l=t(n.readByte());o.lctFlag=l.shift(),o.interlaced=l.shift(),o.sorted=l.shift(),o.reserved=l.splice(0,2),o.lctSize=e(l.splice(0,3)),o.lctFlag&&(o.lct=a(1<<o.lctSize+1)),o.lzwMinCodeSize=n.readByte();var s=i();o.pixels=function(e,t){for(var n,r,a=0,i=function(e){for(var n=0,r=0;r<e;r++)t.charCodeAt(a>>3)&1<<(7&a)&&(n|=1<<r),a++;return n},o=[],l=1<<e,s=l+1,c=e+1,d=[],u=function(){d=[],c=e+1;for(var t=0;t<l;t++)d[t]=[t];d[l]=[],d[s]=null};;)if(r=n,(n=i(c))!==l){if(n===s)break;if(n<d.length)r!==l&&d.push(d[r].concat(d[n][0]));else{if(n!==d.length)throw new Error("Invalid LZW code.");d.push(d[r].concat(d[r][0]))}o.push.apply(o,d[n]),d.length===1<<c&&c<12&&c++}else u();return o}(o.lzwMinCodeSize,s),o.interlaced&&(o.pixels=function(e,t){for(var n=new Array(e.length),r=e.length/t,a=function(r,a){var i=e.slice(a*t,(a+1)*t);n.splice.apply(n,[r*t,t].concat(i))},i=[0,4,2,1],o=[8,8,4,2],l=0,s=0;s<4;s++)for(var c=i[s];c<r;c+=o[s])a(c,l),l++;return n}(o.pixels,o.width)),r.img&&r.img(o)},l=function(){var a={};switch(a.sentinel=n.readByte(),String.fromCharCode(a.sentinel)){case"!":a.type="ext",function(a){switch(a.label=n.readByte(),a.label){case 249:a.extType="gce",function(a){n.readByte();var i=t(n.readByte());a.reserved=i.splice(0,3),a.disposalMethod=e(i.splice(0,3)),a.userInput=i.shift(),a.transparencyGiven=i.shift(),a.delayTime=n.readUnsigned(),a.transparencyIndex=n.readByte(),a.terminator=n.readByte(),r.gce&&r.gce(a)}(a);break;case 254:a.extType="com",function(e){e.comment=i(),r.com&&r.com(e)}(a);break;case 1:a.extType="pte",function(e){n.readByte(),e.ptHeader=n.readBytes(12),e.ptData=i(),r.pte&&r.pte(e)}(a);break;case 255:a.extType="app",function(e){switch(n.readByte(),e.identifier=n.read(8),e.authCode=n.read(3),e.identifier){case"NETSCAPE":!function(e){n.readByte(),e.unknown=n.readByte(),e.iterations=n.readUnsigned(),e.terminator=n.readByte(),r.app&&r.app.NETSCAPE&&r.app.NETSCAPE(e)}(e);break;default:!function(e){e.appData=i(),r.app&&r.app[e.identifier]&&r.app[e.identifier](e)}(e)}}(a);break;default:a.extType="unknown",function(e){e.data=i(),r.unknown&&r.unknown(e)}(a)}}(a);break;case",":a.type="img",o(a);break;case";":a.type="eof",r.eof&&r.eof(a);break;default:throw new Error("Unknown block: 0x"+a.sentinel.toString(16))}"eof"!==a.type&&setTimeout(l,0)};!function(){var i={};if(i.sig=n.read(3),i.ver=n.read(3),"GIF"!==i.sig)throw new Error("Not a GIF file.");i.width=n.readUnsigned(),i.height=n.readUnsigned();var o=t(n.readByte());i.gctFlag=o.shift(),i.colorRes=e(o.splice(0,3)),i.sorted=o.shift(),i.gctSize=e(o.splice(0,3)),i.bgColor=n.readByte(),i.pixelAspectRatio=n.readByte(),i.gctFlag&&(i.gct=a(1<<i.gctSize+1)),r.hdr&&r.hdr(i)}(),setTimeout(l,0)},function(e){var t,a,i={vp_l:0,vp_t:0,vp_w:null,vp_h:null,c_w:null,c_h:null};for(var o in e)i[o]=e[o];i.vp_w&&i.vp_h&&(i.is_vp=!0);var l=null,s=!1,c=null,d=null,u=null,h=null,p=null,f=null,g=null,_=!0,y=!1,w=[],v=[],m=i.gif;void 0===i.auto_play&&(i.auto_play=!m.getAttribute("rel:auto_play")||"1"==m.getAttribute("rel:auto_play"));var x,b,T,B,C=i.hasOwnProperty("on_end")?i.on_end:null,P=i.hasOwnProperty("loop_delay")?i.loop_delay:0,k=i.hasOwnProperty("loop_mode")?i.loop_mode:"auto",S=!i.hasOwnProperty("draw_while_loading")||i.draw_while_loading,A=!!S&&(!i.hasOwnProperty("show_progress_bar")||i.show_progress_bar),E=i.hasOwnProperty("progressbar_height")?i.progressbar_height:25,I=i.hasOwnProperty("progressbar_background_color")?i.progressbar_background_color:"rgba(255,255,255,0.4)",U=i.hasOwnProperty("progressbar_foreground_color")?i.progressbar_foreground_color:"rgba(255,0,22,.8)",O=function(){c=null,d=null,p=u,u=null,f=null},R=function(){try{r(t,H)}catch(e){D("parse")}},z=function(e,t){x.width=e*L(),x.height=t*L(),T.style.minWidth=e*L()+"px",B.width=e,B.height=t,B.style.width=e+"px",B.style.height=t+"px",B.getContext("2d").setTransform(1,0,0,1,0,0)},N=function(e,t,n){if(n&&A){var r,a,o,l=E;i.is_vp?y?(a=(i.vp_t+i.vp_h-l)/L(),l/=L(),r=i.vp_l/L()+e/t*(i.vp_w/L()),o=x.width/L()):(a=i.vp_t+i.vp_h-l,l=l,r=i.vp_l+e/t*i.vp_w,o=x.width):(a=(x.height-l)/(y?L():1),r=e/t*x.width/(y?L():1),o=x.width/(y?L():1),l/=y?L():1),b.fillStyle=I,b.fillRect(r,a,o-r,l),b.fillStyle=U,b.fillRect(0,a,r,l)}},D=function(e){l=e,a={width:m.width,height:m.height},w=[],b.fillStyle="black",b.fillRect(0,0,i.c_w?i.c_w:a.width,i.c_h?i.c_h:a.height),b.strokeStyle="red",b.lineWidth=3,b.moveTo(0,0),b.lineTo(i.c_w?i.c_w:a.width,i.c_h?i.c_h:a.height),b.moveTo(0,i.c_h?i.c_h:a.height),b.lineTo(i.c_w?i.c_w:a.width,0),b.stroke()},F=function(){f&&(w.push({data:f.getImageData(0,0,a.width,a.height),delay:d}),v.push({x:0,y:0}))},M=function(){var e,t,n,r=-1,a=0,o=function(e){r+=e,c()},s=(e=!1,t=function(){null!==C&&C(m),a++,!1!==k||a<0?n():(e=!1,_=!1)},n=function(){if(e=_){o(1);var a=10*w[r].delay;a||(a=100),0==(r+1+w.length)%w.length?(a+=P,setTimeout(t,a)):setTimeout(n,a)}},function(){e||setTimeout(n,0)}),c=function(){var e;(r=parseInt(r,10))>w.length-1&&(r=0),r<0&&(r=0),e=v[r],B.getContext("2d").putImageData(w[r].data,e.x,e.y),b.globalCompositeOperation="copy",b.drawImage(B,0,0)};return{init:function(){l||(i.c_w&&i.c_h||b.scale(L(),L()),i.auto_play?s():(r=0,c()))},step:s,play:function(){_=!0,s()},pause:function(){_=!1},playing:_,move_relative:o,current_frame:function(){return r},length:function(){return w.length},move_to:function(e){r=e,c()}}}(),G=function(e){N(t.pos,t.data.length,e)},W=function(){},j=function(e,t){return function(n){e(n),G(t)}},H={hdr:j((function(e){z((a=e).width,a.height)})),gce:j((function(e){F(),O(),c=e.transparencyGiven?e.transparencyIndex:null,d=e.delayTime,u=e.disposalMethod})),com:j(W),app:{NETSCAPE:j(W)},img:j((function(e){f||(f=B.getContext("2d"));var t=w.length,n=e.lctFlag?e.lct:a.gct;t>0&&(3===p?null!==h?f.putImageData(w[h].data,0,0):f.clearRect(g.leftPos,g.topPos,g.width,g.height):h=t-1,2===p&&f.clearRect(g.leftPos,g.topPos,g.width,g.height));var r=f.getImageData(e.leftPos,e.topPos,e.width,e.height);e.pixels.forEach((function(e,t){e!==c&&(r.data[4*t+0]=n[e][0],r.data[4*t+1]=n[e][1],r.data[4*t+2]=n[e][2],r.data[4*t+3]=255)})),f.putImageData(r,e.leftPos,e.topPos),y||(b.scale(L(),L()),y=!0),S&&(b.drawImage(B,0,0),S=i.auto_play),g=e}),!0),eof:function(e){F(),G(!1),i.c_w&&i.c_h||(x.width=a.width*L(),x.height=a.height*L()),M.init(),s=!1,X&&X(m)}},q=function(){var e=m.parentNode,t=document.createElement("div");x=document.createElement("canvas"),b=x.getContext("2d"),T=document.createElement("div"),B=document.createElement("canvas"),t.width=x.width=m.width,t.height=x.height=m.height,T.style.minWidth=m.width+"px",t.className="jsgif",T.className="jsgif_toolbar",t.appendChild(x),t.appendChild(T),e.insertBefore(t,m),e.removeChild(m),i.c_w&&i.c_h&&z(i.c_w,i.c_h),V=!0},L=function(){return i.max_width&&a&&a.width>i.max_width?i.max_width/a.width:1},V=!1,X=!1,Z=function(e){return!s&&(X=e||!1,s=!0,w=[],O(),h=null,p=null,f=null,g=null,!0)};return{play:M.play,pause:M.pause,move_relative:M.move_relative,move_to:M.move_to,get_playing:function(){return _},get_canvas:function(){return x},get_canvas_scale:function(){return L()},get_loading:function(){return s},get_auto_play:function(){return i.auto_play},get_length:function(){return M.length()},get_current_frame:function(){return M.current_frame()},load_url:function(e,r){if(Z(r)){var a=new XMLHttpRequest;a.open("GET",e,!0),"overrideMimeType"in a?a.overrideMimeType("text/plain; charset=x-user-defined"):"responseType"in a?a.responseType="arraybuffer":a.setRequestHeader("Accept-Charset","x-user-defined"),a.onloadstart=function(){V||q()},a.onload=function(e){200!=this.status&&D("xhr - response"),"response"in this||(this.response=new VBArray(this.responseText).toArray().map(String.fromCharCode).join(""));var r=this.response;r.toString().indexOf("ArrayBuffer")>0&&(r=new Uint8Array(r)),t=new n(r),setTimeout(R,0)},a.onprogress=function(e){e.lengthComputable&&N(e.loaded,e.total,!0)},a.onerror=function(){D("xhr")},a.send()}},load:function(e){this.load_url(m.getAttribute("rel:animated_src")||m.src,e)},load_raw:function(e,r){Z(r)&&(V||q(),t=new n(e),setTimeout(R,0))},set_frame_offset:function(e,t){v[e]?(void 0!==t.x&&(v[e].x=t.x),void 0!==t.y&&(v[e].y=t.y)):v[e]=t}}})}();
//# sourceMappingURL=libgif.85e2ff0c.js.map
