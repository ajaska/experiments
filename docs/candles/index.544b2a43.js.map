{"mappings":"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","sources":["./src/candles/index.tsx","./node_modules/classnames/index.js"],"sourcesContent":["import * as React from \"react\";\nimport * as ReactDOM from \"react-dom\";\n\nimport classNames from \"classnames\";\n\ndeclare var process: any;\nconst ws_url =\n  process.env.NODE_ENV === \"development\"\n    ? \"ws://localhost:1236\"\n    : \"wss://experiments-do.ajaska.com:443/candles/\";\n\ninterface CandleProps {\n  message: string | null;\n  setMessage: (message: string | null) => void;\n}\n\nconst Candle = (props: CandleProps) => {\n  const [mine, setMine] = React.useState(false);\n  const [composing, setComposing] = React.useState(false);\n  const [composedMessage, setComposedMessage] = React.useState(\"\");\n\n  const inputRef = React.useRef<HTMLInputElement>(null);\n\n  const { message, setMessage } = props;\n  const lit = message != null;\n  const setLit = (x: boolean) => {\n    if (!mine && message == null) setMine(true);\n    if (mine || message == null) setComposing(true);\n\n    // This input hack (instead of just using autoFocus) is to work around\n    // a limitation of iOS.\n    // https://github.com/JedWatson/react-select/issues/3501\n    const input = inputRef.current;\n    if (input != null) {\n      input.focus();\n    }\n\n    setMessage(x ? \"\" : null);\n  };\n\n  const [animationDelay] = React.useState(\n    (Math.random() * -4).toFixed(1) + \"s\"\n  );\n  const [animationDuration] = React.useState(\n    (Math.random() + 3.5).toFixed(1) + \"s\"\n  );\n\n  const composer = (\n    <form\n      onSubmit={(e) => {\n        e.preventDefault();\n        setComposing(false);\n        setComposedMessage(\"\");\n        setMessage(composedMessage);\n      }}\n    >\n      <input\n        type=\"text\"\n        value={composedMessage}\n        onChange={(e) => setComposedMessage(e.currentTarget.value)}\n        onBlur={() => {\n          if (composing) {\n            setComposing(false);\n            setComposedMessage(\"\");\n            setMessage(composedMessage);\n          }\n        }}\n        placeholder=\"Leave a message...\"\n        className=\"composer\"\n        ref={inputRef}\n      />\n    </form>\n  );\n\n  return (\n    <div\n      className={classNames(\"candle-frame\", { lit })}\n      onClick={() => setLit(!lit)}\n    >\n      <div\n        className={classNames(\"candle\", { unlit: !lit })}\n        style={{ animationDelay, animationDuration }}\n      >\n        <div className=\"flame\">\n          <div className=\"shadows\" />\n          <div\n            className=\"orange\"\n            style={{ animationDelay, animationDuration }}\n          />\n          <div className=\"blue\" />\n        </div>\n        <div className=\"wick\" />\n        <div className=\"wax\" />\n      </div>\n      <div className={classNames(\"message\", { composing })}>\n        {lit && message}\n        <div className=\"composer-holder\">{composer}</div>\n      </div>\n    </div>\n  );\n};\n\nconst App = () => {\n  const [websocket, setWebsocket] = React.useState<WebSocket | null>(null);\n  const [websocketError, setWebsocketError] = React.useState(false);\n  const [messages, setMessages] = React.useState<(string | null)[]>([]);\n\n  React.useEffect(() => {\n    const websocket = new WebSocket(ws_url);\n    websocket.onmessage = (e) => {\n      const data: (string | null)[] = JSON.parse(e.data);\n      setMessages(data);\n    };\n\n    websocket.onerror = (e) => {\n      console.log(\"websocket error\", e);\n      setWebsocket(null);\n      setWebsocketError(true);\n    };\n\n    websocket.onclose = (e) => {\n      console.log(\"websocket closed\", e);\n      setWebsocket(null);\n      setWebsocketError(true);\n    };\n\n    setWebsocket(websocket);\n\n    return () => {\n      websocket.close();\n    };\n  }, []);\n\n  if (websocket == null && !websocketError) {\n    return <div>Loading...</div>;\n  } else if (websocket == null) {\n    return <div>Error connecting to server</div>;\n  }\n\n  const candleNodes = [...Array(20).keys()].map((i: number) => (\n    <Candle\n      key={i}\n      message={messages[i]}\n      setMessage={(message: null | string) =>\n        websocket.send(JSON.stringify({ message, i }))\n      }\n    />\n  ));\n\n  return <div className=\"container\">{candleNodes}</div>;\n};\n\nReactDOM.render(<App />, document.getElementById(\"react\"!));\n","/*!\n  Copyright (c) 2017 Jed Watson.\n  Licensed under the MIT License (MIT), see\n  http://jedwatson.github.io/classnames\n*/\n/* global define */\n\n(function () {\n\t'use strict';\n\n\tvar hasOwn = {}.hasOwnProperty;\n\n\tfunction classNames () {\n\t\tvar classes = [];\n\n\t\tfor (var i = 0; i < arguments.length; i++) {\n\t\t\tvar arg = arguments[i];\n\t\t\tif (!arg) continue;\n\n\t\t\tvar argType = typeof arg;\n\n\t\t\tif (argType === 'string' || argType === 'number') {\n\t\t\t\tclasses.push(arg);\n\t\t\t} else if (Array.isArray(arg) && arg.length) {\n\t\t\t\tvar inner = classNames.apply(null, arg);\n\t\t\t\tif (inner) {\n\t\t\t\t\tclasses.push(inner);\n\t\t\t\t}\n\t\t\t} else if (argType === 'object') {\n\t\t\t\tfor (var key in arg) {\n\t\t\t\t\tif (hasOwn.call(arg, key) && arg[key]) {\n\t\t\t\t\t\tclasses.push(key);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn classes.join(' ');\n\t}\n\n\tif (typeof module !== 'undefined' && module.exports) {\n\t\tclassNames.default = classNames;\n\t\tmodule.exports = classNames;\n\t} else if (typeof define === 'function' && typeof define.amd === 'object' && define.amd) {\n\t\t// register as 'classnames', consistent with npm package name\n\t\tdefine('classnames', [], function () {\n\t\t\treturn classNames;\n\t\t});\n\t} else {\n\t\twindow.classNames = classNames;\n\t}\n}());\n"],"names":["React","_interopRequireWildcard","require","ReactDOM","_classnames","Candle","props","mine","setMine","useState","composing","setComposing","composedMessage","setComposedMessage","inputRef","useRef","message","setMessage","lit","animationDelay","Math","random","toFixed","animationDuration","composer","createElement","onSubmit","e","preventDefault","type","value","onChange","currentTarget","onBlur","placeholder","className","ref","default","onClick","x","input","current","focus","setLit","unlit","style","App","websocket","setWebsocket","websocketError","setWebsocketError","messages","setMessages","useEffect","WebSocket","onmessage","data","JSON","parse","onerror","console","log","onclose","close","candleNodes","Array","keys","map","i","key","send","stringify","render","document","getElementById","hasOwn","hasOwnProperty","classNames","classes","arguments","length","arg","argType","push","isArray","inner","apply","call","join","module","exports","window"],"version":3,"file":"index.544b2a43.js.map"}