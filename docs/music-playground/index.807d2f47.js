!function(e,t,n,o,i){var r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},a="function"==typeof r.parcelRequire&&r.parcelRequire,s="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);function d(n,o){if(!t[n]){if(!e[n]){var i="function"==typeof parcelRequire&&parcelRequire;if(!o&&i)return i(n,!0);if(a)return a(n,!0);if(s&&"string"==typeof n)return s(n);var r=new Error("Cannot find module '"+n+"'");throw r.code="MODULE_NOT_FOUND",r}u.resolve=function(t){return e[n][1][t]||t},u.cache={};var l=t[n]=new d.Module(n);e[n][0].call(l.exports,u,l,l.exports,this)}return t[n].exports;function u(e){return d(u.resolve(e))}}d.isParcelRequire=!0,d.Module=function(e){this.id=e,this.bundle=d,this.exports={}},d.modules=e,d.cache=t,d.parent=a,d.register=function(t,n){e[t]=[function(e,t){t.exports=n},{}]},r.parcelRequire=d;for(var l=0;l<n.length;l++)d(n[l]);var u=d("1sJPi");"object"==typeof exports&&"undefined"!=typeof module?module.exports=u:"function"==typeof define&&define.amd&&define((function(){return u}))}({"1sJPi":[function(e,t,n){"use strict";var o;(o=e("lodash.throttle"))&&o.__esModule;window.AudioSupervisor=function(){var e,t=this;return t.init=function(t){document.addEventListener&&document.addEventListener("visibilitychange",n),Tone.Transport.latencyHint=b()?.06:"fastest",e=[]},t.makeGestureOnElementResumeAudioContext=function(e){function t(){Tone.context.resume().then((function(){e.removeEventListener("touchstart",t,!0),e.removeEventListener("touchend",t,!0),e.removeEventListener("mousedown",t,!0),e.removeEventListener("mouseup",t,!0),e.removeEventListener("click",t,!0)}))}e.addEventListener("touchstart",t,!0),e.addEventListener("touchend",t,!0),e.addEventListener("mousedown",t,!0),e.addEventListener("mouseup",t,!0),e.addEventListener("click",t,!0)},t.registerPlayingWidget=function(t){-1==e.indexOf(t)&&e.push(t)},t.unregisterPlayingWidget=function(t){e=e.filter((function(e){return e!=t}))},t.isOnlyWidgetPlaying=function(t){return 1===e.length&&e[0]===t},t.areAnyWidgetsPlaying=function(){return 0<e.length},t.masterEffectChain=function(){return Tone.Master},t;function n(){document.hidden&&Tone?Tone.Master.volume.rampTo(-1/0,.3):Tone&&Tone.Master.volume.rampTo(0,.4)}};var i=function(){var e=window.hasOwnProperty("AudioContext")||window.hasOwnProperty("webkitAudioContext"),t=window.hasOwnProperty("Promise"),n=window.hasOwnProperty("Worker");return e&&t&&n},r=function(e,t){var n=document.createElement("div");n.className="widget__compatibility-message",n.innerHTML=t,e.appendChild(n)},a=window.Drumkit=function(){var e,t,n,o=this;return o.init=function(o){return e||(e=new Promise((function(e){var r=o.map((function(e){return{path:e.path,name:e.midi+""}})),a=SAMPLE_CACHE.getBuffers(r);(n=new Tone.MultiPlayer(a).toMaster()).fadeOut=.01,t=e,Tone.Buffer.on("progress",i),Tone.Buffer.on("load",i),i()})))},o.playNoteAtNumber=r,o.playNotes=function(e){e.forEach((function(t){e.some((function(e){return t.lane.midi===e.lane.choke}))||r(t.lane.midi,t.time,t.lane.choke)}))},o.stopAll=function(){n.stopAll()},o;function i(){n.buffers.loaded&&t()}function r(e,t,o){n.start(e+"",t),o&&I.multiplayerStopAll(n,o+"",t)}},s=(window.KeySupervisor=function(){var e,t,n,o,i=this;return i.init=function(o){document.addEventListener("keydown",(function(n){!function(t){return!0===e[t.keyCode]}(n)&&(e[n.keyCode]=!0,t&&t(n))}),!0),document.addEventListener("keyup",(function(t){e[t.keyCode]=!1,n&&n(t)}),!0),document.addEventListener&&document.addEventListener("visibilitychange",r),e={}},i.connectWidget=function(e,i,r){o&&o(),t=e,n=i,o=r},i;function r(){document.hidden&&o&&(o(),o=n=t=null)}},{serviceURL:"https://learningmusic-export.ableton.com",checkExportServiceAvailablility:function(e){var t=new XMLHttpRequest;t.timeout=5e3,t.addEventListener("load",(function(){e(!0)})),t.addEventListener("error",(function(){e(!1)})),t.addEventListener("abort",(function(){e(!1)})),t.addEventListener("timeout",(function(){e(!1)})),t.open("GET",s.serviceURL+"/availability"),t.send()},createLiveSet:function(e,t,n){var o=(new Date).toDateString().replace(/[^a-z0-9]/gi,"_"),i={backlink:window.location.href,name:"idea_"+o,tempo:e,tracks:t};if(!s.userHasAlreadyExportedOnce())var r=window.open(LOCALE_PATH+"/live-set-export-waiting.html","_blank");var a=new XMLHttpRequest;a.addEventListener("load",(function(){n(void 0);var e=this.responseText;if(s.userHasAlreadyExportedOnce())s.isValidFileId(e)&&(window.location=s.downloadURLFromFileId(e));else{w("localStorage")&&localStorage.setItem("__userHasExported","yes");var t="?fileId="+e;r.location.href=LOCALE_PATH+"/live-set-export.html"+t}})),a.addEventListener("error",(function(){n("Export failed.")})),a.addEventListener("abort",(function(){n("Export was cancelled.")})),a.open("POST",s.serviceURL+"/export"),a.setRequestHeader("Content-Type","application/json;charset=UTF-8"),a.send(JSON.stringify(i))},downloadURLFromFileId:function(e){return s.serviceURL+"/export?id="+e},userHasAlreadyExportedOnce:function(){return!!w("localStorage")&&"yes"==localStorage.getItem("__userHasExported")},isValidFileId:function(e){return e.match("[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}")},createDownloadLink:function(e,t){var n,o,i=("fileId",n=window.location.href,(o=new RegExp("[?&]fileId=([^&#]*)","i").exec(n))?o[1]:null);if(s.isValidFileId(i)){void 0===t&&(t="");var r=document.createElement("a"),a=document.createTextNode("Download");r.appendChild(a),r.title="Download your music as an Ableton Live Set",r.href=s.downloadURLFromFileId(i),r.className=t,document.getElementById(e).appendChild(r),r.addEventListener("click",(function(){r.style.display="none"}))}else document.getElementById(e).innerHTML="Error exporting to Live. Please try again."}}),d=(window.LiveSetExporter=function(){var e;return this.init=function(){e=[]},this.registerWidget=function(t){e.push(t),t.bind("export",(function(t,n){var o=t.getExportInfo();if("takeover"===t.getConfig().onPlay)s.createLiveSet(o.tempo,o.tracks,n);else{var i=e.reduce((function(e,t){return e.concat(t.getExportInfo().tracks)}),[]);s.createLiveSet(o.tempo,i,n)}}))},this},window.Loader=function(){var e,t;return this.init=function(n){(e=document.createElement("div")).id=n.widgetId+"loader",e.className="",(t=document.createElement("div")).className="widget-loader__loading-animation",e.appendChild(t),document.getElementById(n.widgetId).appendChild(e)},this.hide=function(){e.style.display="none"},this.onAudioLoaded=function(){t.style.display="none"},this}),l=(window.Metronome=function(){var e,t;return this.init=function(t){var o="./sounds/",i={metro:o+"metronome/Metronome"+h(),metroup:o+"metronome/MetronomeUp"+h()};(e=new Tone.MultiPlayer(i,n).toMaster()).volume.value=12},this.start=function(e){n(),t.start(e)},this.stop=function(e){t.stop(e),t.dispose()},this;function n(){t=new Tone.Sequence((function(t,n){e.start(n,t)}),["metroup","metro","metro","metro"],"4n")}},window.Piano=function(){var e,t,n,o,i,r=this;return r.init=function(r){return o=r,e=e||new Promise((function(e){var o,s,d=r.samples.map((function(e){return{path:e.path,name:e.midi+""}})),l=SAMPLE_CACHE.getBuffers(d);(n=new Tone.MultiPlayer(l)).connect(SUPERVISOR.masterEffectChain()),n.fadeOut=r.fadeout.duration,i=[];for(var u=0;u<128;u++)i.push({val:s=v(o=u,r.samples.map((function(e){return e.midi}))),offset:o-s});t=e,Tone.Buffer.on("progress",a),Tone.Buffer.on("load",a),a()}))},r.playNoteAtFrequency=function(e,t,n){s(Math.round(Tone.Frequency(e).toMidi()),t,n)},r.playNoteAtNumber=s,r.stopAll=function(){n.stopAll()},r;function a(){n.buffers.loaded&&t()}function s(e,t,r){var a=i[e];n.start(a.val+"",t,0,r+"-"+o.fadeout.offset,a.offset)}}),u=(window.Recorder=function(){var e;return this.init=function(e){},this.recordEvent=function(t){e&&e(t)},this.connect=function(t){e=t},this},window.SampleCache=function(){var e,t=this;return t.init=function(){e=new Tone.Buffers},t.getBuffer=function(t,n){if(e.has(t))return e.get(t);var o="./sounds/"+t+(n||h());return e.add(t,o),e.get(t)},t.getBuffers=function(e){var n=new Tone.Buffers;return e.forEach((function(e){n.add(e.name,t.getBuffer(e.path,e.extension))})),n},t},window.SingleTouchObserver=function(){var e;return this.init=function(n){e=n,d3.select(n.node).append("div").attr("class","mouseObserver").style("width","100%").style("height","100%").on("mousedown",t).on("touchstart",t)},this;function t(){if("mousedown"!==d3.event.type||0===d3.event.button){var t=d3.select(this).classed("active",!0),n=d3.select(window).on("touchmove",i).on("mousemove",i).on("mouseup",r).on("touchend",r),o=d3.mouse(this);e.onDown(o[0],o[1]),document.activeElement&&document.activeElement.blur(),d3.event.preventDefault()}function i(){var n=d3.mouse(t.node());e.onMove(n[0],n[1])}function r(){var o=d3.mouse(t.node());n.on("touchmove",null).on("mousemove",null).on("mouseup",null).on("touchend",null),e.onUp(o[0],o[1])}}}),c={inject:function(e,t,n,o,i){if(t&&e&&(!c.userHasSeenTooltip(t.name)||t.showalways)){e.getBoundingClientRect(),xShiftFactor=0,"left"==i?xShiftFactor=.25:"right"==i&&(xShiftFactor=-.25),xShiftInPx=200*xShiftFactor;var r=document.createElement("div");r.className="widget-tooltip",r.style.width="200px",r.style.top=n||"100%",r.style.left=o||"50%",r.style.marginTop="12px",r.style.marginLeft=-100+xShiftInPx+"px";var a=document.createElement("div");a.className="widget-tooltip__triangle",a.style.top="-20px",a.style.left=90-xShiftInPx+"px",a.style.border="solid 10px",a.style.borderColor="transparent transparent black transparent",r.appendChild(a);var s=document.createElement("div");s.className="widget-tooltip__text",s.innerHTML=t["@text"],r.appendChild(s);var d=document.createElement("div");d.className="widget-tooltip__dismiss",d.innerHTML=t["@close"]?t["@close"]:"Close",r.appendChild(d),r.addEventListener("click",(function(){r.classList.add("widget-tooltip--hide"),c.setUserHasSeenTooltip(t.name)})),e.appendChild(r)}},tooltipKeyForLocalStorage:function(e){return"__tooltip_"+e},userHasSeenTooltip:function(e){return!!w("localStorage")&&"dismissed"==localStorage.getItem(c.tooltipKeyForLocalStorage(e))},setUserHasSeenTooltip:function(e){w("localStorage")&&localStorage.setItem(c.tooltipKeyForLocalStorage(e),"dismissed")},appendTooltippableChild:function(e,t){var n=document.createElement("div");n.style.position="relative",n.appendChild(t),e.appendChild(n)}},p=window.Transport=function(){var e,t,n,o,i,r,a,s=this;return s.init=function(s){t=s,(e=document.createElement("div")).className="widget-transport",s.node.appendChild(e),(n=document.createElement("button")).onclick=g,c.appendTooltippableChild(e,n),n.parentElement.classList.add("widget__transport-btn-wrapper"),(o=document.createElement("button")).onclick=h,c.appendTooltippableChild(e,o),o.parentElement.classList.add("widget__transport-btn-wrapper"),i="stopped",r=!1,a=s.tempo,Tone.Transport.on("takeover",p),Tone.Transport.on("sessionTempoChanged",d),l()},s.isRecording=function(){return r},s.isPlaying=function(){return"playing"==i},s.getTempo=function(){return a},s.setTempo=function(e){a=e,("join"==t.onPlay||"takeover"==t.onPlay&&"playing"==i)&&(Tone.Transport.bpm.value=a,Tone.Transport.emit("sessionTempoChanged",a)),t.onTempoChanged&&t.onTempoChanged(a)},s.playButton=function(){return n},s.recordButton=function(){return o},s;function d(e){"join"==t.onPlay&&(a=e,t.onTempoChanged&&t.onTempoChanged(a))}function l(){n.innerHTML={playing:"<i class='icon-pause'></i>",queued:"<i class='icon-play widget_transport-icon--queued'></i>",stopped:"<i class='icon-play'></i>"}[i],n.className="btn widget__transport-btn",function(){o.innerHTML="<i class='icon-record'></i>";var e=t.showRecordButton?"":" hidden";o.className=r&&"playing"==i?"btn widget__transport-btn widget-button--recording"+e:"btn widget__transport-btn"+e}()}function u(){r&&(r=!1,METRONOME.stop()),t.onStopPlayback(),SUPERVISOR.unregisterPlayingWidget(t.widgetId),i="stopped",l()}function p(e){"playing"==i&&u()}function f(){Tone.Transport.bpm.value=a,Tone.Transport.position="0:0:0",Tone.Transport.start("+0.1"),r&&METRONOME.start(),t.onStartPlayback(),SUPERVISOR.registerPlayingWidget(t.widgetId),i="playing",l()}function m(){Tone.Transport.position="0:0:0",Tone.Transport.stop(),u()}function g(){if("queued"!=i)if(SUPERVISOR.areAnyWidgetsPlaying()){if(SUPERVISOR.areAnyWidgetsPlaying()){var e="playing"==i;"takeover"==t.onPlay?e?m():(Tone.Transport.emit("takeover"),m(),f()):"join"==t.onPlay&&(e?SUPERVISOR.isOnlyWidgetPlaying(t.widgetId)?m():p():(r&&METRONOME.start("@1m"),Tone.Transport.scheduleOnce((function(e){i="playing",l()}),"@1m"),t.onStartQuantizedPlayback(),SUPERVISOR.registerPlayingWidget(t.widgetId),i="queued",l()))}}else f()}function h(){r=!r,"playing"==i?r?METRONOME.start("0:0:0"):METRONOME.stop():g(),l()}};function f(e){return 4*function(e){return parseFloat(e.split(":")[0])}(e)+function(e){return parseFloat(e.split(":")[1])}(e)+function(e){return parseFloat(e.split(":")[2])}(e)/4}function m(e){return Tone.Time("0:1:0 * "+e).toBarsBeatsSixteenths()}function g(e){return Tone.Buffer.supportsType(e)}function h(){var e=".wav";return g("ogg")?e=".ogg":g("mp4")&&(e=".mp4"),e}function v(e,t){for(var n=Number.MAX_VALUE,o=0;o<t.length;o++){var i=t[o],r=Math.abs(e-n);Math.abs(e-i)<=r&&(n=i)}return n}function w(e){try{var t=window[e],n="__storage_test__";return t.setItem(n,n),t.removeItem(n),!0}catch(e){return!1}}function y(){const e=document.querySelectorAll(".mouseObserver");if(console.log("loading ecl",e),e.length<4)return setTimeout(y,1e3);e.forEach(e=>{let t=null,n=e;for(;null!=n&&-1===Array.from(n.classList).indexOf("widget-pianoroll");)n=n.parentElement;if(null==n)return;t=n.id;e.addEventListener("mousemove",_.throttle(e=>{window.arlan_ws&&arlan_ws.send(JSON.stringify({type:"cursor",cursor:{widget:t,rel_x:e.offsetX/e.target.offsetWidth,rel_y:e.offsetY/e.target.offsetHeight}}))},200))})}function T(e){try{return JSON.parse(function(e){return w("localStorage")?localStorage.getItem(e):void 0}(e))}catch(e){return}}document.addEventListener("DOMContentLoaded",(function(){y()})),window.arlan_cursor_pool=window.arlan_cursor_pool||[],window.arlan_received_state=!1,window.setTimeout(()=>function e(){const t=new WebSocket("wss://experiments-do.ajaska.com:443/music-playground/");t.onmessage=e=>{const t=JSON.parse(e.data);switch(t.type){case"state":{const e=window[t.model],{transport:n,modelSetter:o}=e.getLiveAdjustThings(),i=JSON.parse(t.state);return n&&n.setTempo(i.tempo),o&&o.setModel(i),void(window.arlan_received_state=!0)}case"sound":{const e=window[t.model],{player:n}=e.getLiveAdjustThings();return void n.trigger("playNotes",t.sound)}case"cursor":{const e=t.cursors;let n=window.arlan_cursor_pool;n.length!==e.length&&(n.map(e=>e.remove()),n=e.map(e=>{const t=d3.select("body").append("svg").attr("width",20).attr("height",20).attr("viewBox","0 0 512 512"),n=(t.append("path").attr("fill",e.color).attr("d","M429.742,319.31L82.49,0l-0.231,471.744l105.375-100.826l61.89,141.083l96.559-42.358l-61.89-141.083L429.742,319.31z"),t.node());return n.style.position="absolute",n.style.zIndex="300",n}),window.arlan_cursor_pool=n);const o=window.pageXOffset||document.documentElement.scrollLeft,i=window.pageYOffset||document.documentElement.scrollTop;for(let t=0;t<e.length;t++)if(null==e[t].widget)n[t].style.left="0px",n[t].style.top="0px";else{const r=document.querySelector("#"+e[t].widget+" .mouseObserver").getBoundingClientRect(),a=r.width*e[t].rel_x,s=r.height*e[t].rel_y;n[t].style.left=o+r.x+a+"px",n[t].style.top=i+r.y+s+"px"}return}default:throw new Error("Unable to handle message",t)}},t.onopen=()=>{const e=document.getElementById("connection-status");e.innerHTML="[[ CONNECTION: Online ]]",e.className="online"},t.onclose=()=>{const t=document.getElementById("connection-status");t.innerHTML="[[ CONNECTION: Lost, reconnecting... ]]",t.className="",window.setTimeout(()=>e(),5e3)},window.arlan_ws=t}(),500);function b(){return!!(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i))}function E(e){return e.code?function(e){return e.includes("Digit")?e.split("Digit")[1]:e.includes("Key")?e.split("Key")[1]:void 0}(e.code):String.fromCharCode(e.keyCode)}!function(){function e(e,t){document.cookie=t?e+"=; Path=/; Domain="+t+"; Expires=Thu, 01 Jan 1970 00:00:01 GMT;":e+"=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;"}try{document.cookie.split(";").forEach((function(t){var n=t.split("=")[0];n&&0===n.indexOf("_g")?e(n,document.domain):n&&e(n)}))}catch(e){console.log()}}();var S,I={multiplayerStopAll:function(e,t,n){try{for(;;)e.stop(t,n)}catch(e){}}},x=window.PitchpadSynth=function(){var e,t,n,o,i,r,a=this;return a.init=function(a){e=[],t=3,n=[],o=[],i=[],(r=Tone.context.createGain()).connect(Tone.Master),r.gain.value=.5;for(var s=0;s<t;s++){e[s]=null;var d=Tone.context.createOscillator(),l=Tone.context.createGain();d.type="triangle",d.connect(l),l.connect(r),l.gain.value=1e-6,d.start(0),n.push(d),o.push(l),i.push(-1)}},a.startTouch=function(t,o){var r=e.findIndex((function(e){return null===e}));-1!=r&&(e[r]=t,n[r].frequency.setValueAtTime(o,Tone.context.currentTime),i[r]=o,d(r))},a.moveTouch=function(e,t,o){var r=s(e);-1!=r&&(n[r].frequency.setValueAtTime(t,Tone.context.currentTime),o&&!function(e,t,n){return null==n&&(n=.001),Math.abs(e-t)<n}(t,i[r])&&d(r),i[r]=t)},a.stopTouch=l,a.stopAll=function(){for(var n=0;n<t;n++)l(e[n])},a;function s(t){return e.findIndex((function(e){return e===t}))}function d(e){var t=Tone.context.currentTime;o[e].gain.cancelScheduledValues(t),o[e].gain.setTargetAtTime(1,t+.02,.001),o[e].gain.setTargetAtTime(.3,t+.02+.1,.01)}function l(t){var n=s(t);-1!=n&&(function(e){var t=Tone.context.currentTime;o[e].gain.cancelScheduledValues(t),o[e].gain.setTargetAtTime(0,t+.05,.1)}(n),e[n]=null,i[n]=-1)}},P=(window.ScaleExplorer=function(){var e,t,n,o,a,s,l,u,p,f,m;return this.init=function(o){i()?(e=o,mLoader=new d,mLoader.init(o),mLoader.onAudioLoaded(),function(){SUPERVISOR.makeGestureOnElementResumeAudioContext(document.getElementById(e.widgetId));var o=document.getElementById(e.widgetId);o.style.position="relative";var i=document.createElement("div");i.id=e.widgetId+"appHolder",i.style.textAlign="center",o.appendChild(i),(m=Elm.ScaleExplorer.embed(i,{scale:R(),startNote:function(){var e=R()[0];return e-e%12}(),customNoteNames:M()?null:e.frequencies.map((function(e){return e.name})),customNoteColors:M()?null:e.frequencies.map((function(e){return e.color?e.color:""})),showPiano:"yes"==e.showPiano,showPads:e.isQuantized,showScaleChooser:"yes"==e.showScaleChooser,showRootChooser:"yes"==e.showRootChooser,availableScaleNames:e.availableScales.split(","),defaultScaleName:e.defaultScale,defaultRootName:e.defaultRoot,scaleCanBeMappedToPiano:!("no"==e.scaleCanBeMappedToPiano),keyboardMappings:e.keyboard?e.keyboard.split(""):[],showKeyboardButton:e.isQuantized&&!b(),lang:e.lang})).ports.exportScale.subscribe((function(e){f=e,k(),n.stopAll()})),m.ports.keyboardActive.subscribe((function(e){e?KEY_SUPERVISOR.connectWidget(I,P,O):KEY_SUPERVISOR.connectWidget(null,null,null)})),S||(S=new x).init(),n=S,(t=d3.select("#"+e.widgetId).append("svg").attr("class","widget-scale-explorer__mouse-observer grabbable").style("left","0").style("bottom","0").style("width","100%")).on("mousedown",y),t.on("mousemove",(function(){d3.event.preventDefault()})),t.on("mouseup",(function(){d3.event.preventDefault()})),t.on("touchstart",v),L(),window.addEventListener("resize",L),u=N().map((function(e){return!1})),p=N().map((function(e){return!1})),C([]),d3.timer(w),e.tip&&function(t){switch(t){case"lowhighpitch":c.inject(document.getElementById(e.widgetId),function(t){var n=e.tips[t];return n.name=t,n["@close"]=e.lang["@close"],n}(t),"80%")}}(e.tip)}()):r(document.getElementById(o.widgetId),o.lang["@incompatiblebrowser"])},this;function g(t){return e.isQuantized?a(t):o(t)}function h(){return parseInt(t.style("width"),10)}function v(){d3.event.preventDefault();var o=d3.select(this).classed("active",!0);o.on("touchmove",(function(){d3.event.preventDefault();for(var i=0;i<d3.event.changedTouches.length;i++){var r=d3.event.changedTouches.item(i),a=d3.touch(o.node(),r.identifier)[0];n.moveTouch(r.identifier,g(a),e.isQuantized)}C(d3.touches(t.node()))})).on("touchend",(function(){d3.event.preventDefault();for(var e=0;e<d3.event.changedTouches.length;e++){var i=d3.event.changedTouches.item(e),r=d3.touch(o.node(),i.identifier)[0];n.stopTouch(i.identifier,g(r))}C(d3.touches(t.node()))})).on("touchcancel",(function(){d3.event.preventDefault();for(var e=0;e<d3.event.changedTouches.length;e++){var i=d3.event.changedTouches.item(e),r=d3.touch(o.node(),i.identifier)[0];n.stopTouch(i.identifier,g(r))}C(d3.touches(t.node()))}));for(var i=0;i<d3.event.changedTouches.length;i++){var r=d3.event.changedTouches.item(i),a=d3.touch(o.node(),r.identifier)[0];n.startTouch(r.identifier,g(a))}C(d3.touches(t.node()))}function w(){if(l){l=!1;var e=t.selectAll("circle.widget-scale-explorer__touch").data(s);e.exit().remove(),e.enter().append("circle").attr("class","widget-scale-explorer__touch").attr("r","15px").merge(e).attr("cx",(function(e){return e[0]})).attr("cy",(function(e){return parseInt(t.style("height"),10)/2}))}}function y(){var t=d3.select(this).classed("active",!0),o=d3.select(window).on("mousemove",(function(){var o=d3.mouse(t.node());C([o]),n.moveTouch("mouse",g(o[0]),e.isQuantized)})).on("mouseup",(function(){C([]),n.stopTouch("mouse"),o.on("mousemove",null).on("mouseup",null)}));n.startTouch("mouse",g(d3.mouse(this)[0])),C([d3.mouse(this)]),d3.event.preventDefault()}function T(t){var n=E(t);return null==n?-1:e.keyboard.split("").findIndex((function(e){return e.toUpperCase()==n.toUpperCase()}))}function I(e){var t=T(e);if(!(t<0)){var o=N()[t];if(n.startTouch("key"+t,o),u[t]=!0,m){var i=R()[t];m.ports.noteOn.send(i)}}}function P(e){var t=T(e);if(!(t<0)&&(n.stopTouch("key"+t),u[t]=!1,m)){var o=R()[t];m.ports.noteOff.send(o)}}function C(e){if(l=!0,s=e,p&&m){var t=N().length,n=[],o=h()/t;s.forEach((function(e){var i=e[0],r=_.clamp(Math.floor(i/o),0,t-1);n.push(r)}));for(var i=0;i<p.length;i++){var r=p[i];if(null!=n.find((function(e){return e==i}))){if(!r){p[i]=!0;var a=R()[i];m.ports.noteOn.send(a)}}else r&&(p[i]=!1,a=R()[i],m.ports.noteOff.send(a))}}}function L(){k(),C([])}function O(){m.ports.resetNoteOnState.send(!0),m.ports.keyboardDisconnected.send(!0);for(var e=0;e<u.length;e++)u[e]&&(n.stopTouch("key"+e),u[e]=!1)}function k(){a=d3.scaleQuantize().domain([0,h()]).range(N()),o=d3.scaleLinear().domain([0,h()]).range(N()).clamp(!0)}function M(){return e.defaultRoot||e.defaultScale}function N(){return M()?R().map((function(e){return Tone.Frequency(e,"midi").toFrequency()})):e.frequencies.map((function(e){return e.freq}))}function R(){return M()?f||[0,2,4,5,7,9,11,12].map((function(e){return e+60})):"no"!=e.scaleCanBeMappedToPiano?e.frequencies.map((function(e){return Math.round(Tone.Frequency(e.freq).toMidi())})):e.frequencies.map((function(e,t){return t}))}},window.SimpleDrumpad=function(){var e,t,n,o,s,l,u,p;return this.init=function(n){i()?(e=n,(t=new d).init(e),I()&&t.hide(),u=!1,(l=new a).init(n.kit.samples).then(_)):r(document.getElementById(n.widgetId),n.lang["@incompatiblebrowser"])},this;function f(e){return e.name.replace(/\s/g,"")}function m(t){!function(e){n.select("#"+f(e)).transition().duration(50).style("background-color","#FED134").transition().duration(200).style("background-color","#858585")}(t),l.playNoteAtNumber(t.midi,0,t.choke),e.recorder&&e.recorder.recordEvent(t)}function g(){var t=o.selectAll(".widget__pad").data(e.kit.samples);t.enter().append("div").attr("class","widget__pad widget__pad--drum").attr("id",(function(e,t){return f(e)})).on("mousedown",(function(e,t){m(e),d3.event.preventDefault()})).on("touchstart",(function(e,t){d3.event.stopPropagation(),d3.event.preventDefault(),m(e)})).merge(t).html((function(t,n){return u?"<kbd class='widget__pad__key'>"+e.keyboard.split("")[n].toUpperCase()+"</kbd><div class='widget__pad__label'>"+t.name+"</div>":"<div class='widget__pad__label'>"+t.name+"</div>"}))}function h(t){var n=function(t){var n=E(t);return null==n?-1:e.keyboard.split("").findIndex((function(e){return e.toUpperCase()==n.toUpperCase()}))}(t);-1!=n&&m(e.kit.samples[n])}function v(e){}function w(){u=!1,T(),g()}function y(){u?(KEY_SUPERVISOR.connectWidget(null,null,null),w()):(KEY_SUPERVISOR.connectWidget(h,v,w),u=!0),T(),g()}function T(){var e=u?"widget__keyboard-button--on":"widget__keyboard-button--off";p.className="btn btn--link btn--cropped widget__keyboard-button "+e}function S(){if(!b()){var t=document.getElementById(e.widgetId);(s=document.createElement("div")).className="widget-drumpad__header",s.style.justifyContent="flex-end",t.appendChild(s),(p=document.createElement("button")).innerHTML=e.lang["@keyboard"],p.onclick=y,c.appendTooltippableChild(s,p),p.parentElement.style.width="80px",p.parentElement.classList.add("widget__keyboard-button__wrapper"),T()}}function I(){return null!=e.recorder}function _(){t.onAudioLoaded(),SUPERVISOR.makeGestureOnElementResumeAudioContext(document.getElementById(e.widgetId)),n=d3.select("#"+e.widgetId),I()?(o=n.append("div").attr("id","padHolder").attr("class","widget__pads"),S()):(S(),o=n.append("div").attr("id","padHolder").attr("class","widget__pads")),g(),e.tip&&function(t){function n(t){var n=e.tips[t];return n.name=t,n["@close"]=e.lang["@close"],n}switch(t){case"keyboard":if(b())return;c.inject(p.parentElement,n(t));break;case"drumpad":document.getElementById(e.widgetId).style.position="relative",c.inject(document.getElementById(e.widgetId),n(t),"95%","25%","left")}}(e.tip)}},{lanesMatch:function(e,t,n){var o=e.events.filter((function(e){return e.lane==n})),i=t.events.filter((function(e){return e.lane==n}));return o.length==i.length&&o.every((function(e){return i.find((function(t){return e.start===t.start&&e.duration===t.duration&&e.lane===t.lane}))}))},populatedLanesMatch:function(e,t,n){if(!e||!t)return!1;for(var o=0;o<n;o++)if(0<e.events.filter((function(e){return e.lane==o})).length&&!P.lanesMatch(e,t,o))return!1;return!0},modelsMatch:function(e,t,n){if(!e||!t)return!1;if(e.events.length!=t.events.length)return!1;for(var o=0;o<n;o++)if(!P.lanesMatch(e,t,o))return!1;return!0}}),C=window.PianoRollEditor=function(){var e,t,n,o,i,r,a,s=this;return s.init=function(h){t=h,function(){for(var h=t.lanes,y=0;y<h.length;y++)void 0===h[y].color&&(h[y].color="none"),void 0===h[y].freq&&(h[y].freq=null),void 0===h[y].midi&&(h[y].midi=null),void 0===h[y].choke&&(h[y].choke=null);(r=document.createElement("div")).style.width=f()+"px",r.style.position="relative",r.style.overflow="hidden",r.style.backgroundColor="#666",c.appendTooltippableChild(document.getElementById(t.widgetId),r);var T=document.createElement("div");r.appendChild(T),(e=Elm.SimplePianoRoll.embed(T,{lanes:h,beats:t.beats,gridSize:t.gridSize/4,width:f(),height:p(),labelWidth:w(),scaleName:t.defaultScale?t.defaultScale:null,rootName:t.defaultRoot?t.defaultRoot:null,octave:t.defaultOctave?parseInt(t.defaultOctave):null,octaveCount:t.defaultOctaveCount?parseInt(t.defaultOctaveCount):null,showRootChooser:"yes"==t.showRootChooser,showScaleChooser:"yes"==t.showScaleChooser,availableScales:t.availableScales?t.availableScales.split(","):[],showTempoSlider:"no"!=t.showTempoSlider,showSettings:!0,tempo:parseFloat(t.tempo),highlightedLanes:t.highlightedLanes?t.highlightedLanes:[],options:{allowResize:null==t.allowResize||t.allowResize}})).ports.exportModel.subscribe((function(e){var t=!n||e.page!=n.page,o=!n||e.lanes.length!=n.lanes.length;n=e,s.trigger("modelChange",e),t&&s.trigger("pageChange"),o&&d()})),e.ports.previewNotes.subscribe((function(e){s.trigger("previewNotes",e,!0)})),e.ports.notesSelected.subscribe((function(e){s.trigger("previewNotes",e,!0)})),e.ports.notesDragged.subscribe((function(e){s.trigger("previewNotes",e,!0)})),e.ports.notesAdded.subscribe((function(e){s.trigger("previewNotes",e,!1)})),e.ports.tempoChanged.subscribe((function(e){s.trigger("tempoChanged",e)})),(a=document.createElement("div")).className="widget-pianoroll__mouse-observer-holder",a.style.left=w()+"px",a.style.width=m()+"px",a.style.height=g()+"px",r.appendChild(a),(new u).init({node:a,onDown:function(t,n){e.ports.mouseDown.send([t,n])},onMove:function(t,n){e.ports.mouseMove.send([t,n])},onUp:function(t,n){e.ports.mouseUp.send([t,n])}}),(o=document.createElement("div")).className="widget-pianoroll__playhead",o.style.bottom="0px",o.style.height=g()-2+"px",r.appendChild(o),(i=document.createElement("div")).className="widget-pianoroll__playhead",i.style.bottom=l()+"px",i.style.height=v()-1+"px",r.appendChild(i),d(),window.addEventListener("resize",d)}()},s.clear=function(){e.ports.clear.send("")},s.setModel=function(n){n&&2==n.version&&(n.lanes=t.lanes,n.showSettings=!0,null!=n.scaleName&&"yes"==t.showScaleChooser||(n.scaleName=t.defaultScale?t.defaultScale:null),null!=n.rootName&&"yes"==t.showRootChooser||(n.rootName=t.defaultRoot?t.defaultRoot:null),n.octave=t.defaultOctave?parseInt(t.defaultOctave):null,n.octaveCount=t.defaultOctaveCount?parseInt(t.defaultOctaveCount):null,null==n.tempo?n.tempo=parseFloat(t.tempo):n.tempo=parseFloat(n.tempo),e.ports.importModel.send(n))},s.getModel=function(e){return n},s.record=function(t){e.ports.record.send([t.lane,t.start])},s.setPlayhead=function(e){if(0<e){i.style.transform="translateX("+(e*m()+w())+"px)",i.style.opacity=1;var r=function(){var e=n?n.page:-1,o=-1==e||0==e?0:4*e-.25,i=-1==e||e==t.beats/4-1?t.beats:4*(e+1)+.25;return[o/t.beats,i/t.beats]}(),a=function(e,t,n){return(n-e)/(t-e)}(r[0],r[1],e);!function(e,t,n){return e<=n&&n<=t}(0,1,a)?o.style.opacity=0:(o.style.transform="translateX("+(a*m()+w())+"px)",o.style.opacity=1)}else o.style.opacity=0,i.style.opacity=0},s.setOptions=function(t){e.ports.setOptions.send(t)},s.updateTempo=function(t){e.ports.setTempo.send(parseFloat(t))},s.getEditorTooltipWrapper=function(){return r.parentElement},s;function d(){r.style.width=f()+"px",o.style.height=g()-1+"px",a.style.width=m()+"px",a.style.height=g()+"px",i.style.bottom=l()+"px",e.ports.setSize.send([f(),p()])}function l(){return g()+1}function p(){return g()+v()}function f(){var e=document.getElementById(t.widgetId);return parseInt(e.offsetWidth,10)}function m(){return f()-w()}function g(){return function(){var e=b()?36:60,t=(25-e)/12,n=e-4*t,o=Math.round(t*h()+n);return _.clamp(o,25,e)}()*h()}function h(){return n?n.lanes.length:t.lanes.length}function v(){return 4<t.beats?50:0}function w(){return t?"drums"!=t.material||b()?62:124:62}};MicroEvent.mixin(C);var L={createExportData:function(e,t,n){var o=e.events.map((function(t){return{midi:L.laneToMidi(e,t.lane),startInBeats:t.start,durationInBeats:t.duration}}));return{tempo:t,tracks:[{instrument:n,clip:{lengthInBeats:e.beats,notes:o}}]}},laneToMidi:function(e,t){var n=e.lanes.length,o=e.lanes[n-1-t];return o.freq?Math.round(Tone.Frequency(o.freq).toMidi()):o.midi}},O=window.PianoRollPlayer=function(e){var t,n,o,i,r=this;return r.setModel=function(e){n=e},r.setLoop=function(e){i=e,t&&(s(),Tone.Transport.position="0:0:0",a())},r.start=a,r.stop=s,r.record=function(e){(o=o||[]).push(e)},r.progress=function(){if(!n||!t)return 0;var e=f(Tone.Time(t.loopStart).toBarsBeatsSixteenths()),o=f(Tone.Time(t.loopEnd).toBarsBeatsSixteenths());return(e+t.progress*(o-e))/n.beats},r.previewNotes=function(t){var o=t.map((function(e){return e.lane})),i=_.uniq(o).map((function(e){var t=n.lanes.length-1-e;return{lane:n.lanes[t],length:"16n",time:"+0.1"}}));i.length>0&&window.arlan_ws&&window.arlan_ws.send(JSON.stringify({type:"sound",model:e.getConfig().widgetId,sound:i})),r.trigger("playNotes",i)},r;function a(e){n&&(function(){var e=1/n.gridSize,i=4*n.gridSize+"n",a=n.gridSize*n.beats,s=n.lanes.length;t&&t.dispose(),t=new Tone.Sequence((function(t,a){if(n){var d=a*e;o&&function(e){o=o.filter((function(t){return(t.start+t.duration)%n.beats>e})),0===e&&(o=o.filter((function(e){return e.start+e.duration>n.beats})))}(d);var l=function(e){return n.events.filter((function(t){return t.start==e}))}(d).filter((function(e){return!(o&&-1!=o.findIndex((function(t){return t.lane==e.lane})))})).map((function(o){var r=o.duration/e,a=s-o.lane-1,d=i+" * "+r;return{lane:n.lanes[a],length:d,time:t}}));r.trigger("playNotes",l)}}),_.range(0,a),i)}(),i?(t.loopStart=m(i.start),t.loopEnd=m(i.end),t.loop=!0,t.start(e,t.loopStart)):t.start(e))}function s(e){t&&t.stop(e)}};MicroEvent.mixin(O);var k=window.SimplePianoRoll=function(){var e,t,n,o,u,f,m,g,h,v,y=this;return y.init=function(n){i()?(b()&&document.getElementById(n.widgetId).classList.add("widget-is-mobile"),t=n,(e=new d).init(t),t.recorder&&t.recorder.connect(U),t.exporter&&"yes"!=t.disableExport&&t.exporter.registerWidget(y),m=new O(y),"tonal"==t.material?(h=new l).init(t.instrument).then(E):"drums"==t.material&&(h=new a).init(t.instrument.samples).then(E),R(),v=_.debounce(x,500)):r(document.getElementById(n.widgetId),n.lang["@incompatiblebrowser"])},y.showTargetState=function(){n.setTempo(A()),g.setModel(JSON.parse(t.targetState))},y.getExportInfo=function(){return L.createExportData(g.getModel(),n.getTempo(),t.instrument.livePreset)},y.getConfig=function(){return t},y.getLiveAdjustThings=function(){return{transport:n,modelSetter:g,player:m}},y;function E(){e.onAudioLoaded(),SUPERVISOR.makeGestureOnElementResumeAudioContext(document.getElementById(t.widgetId)),function(){var e=document.createElement("div");e.className="widget__menu",document.getElementById(t.widgetId).appendChild(e),(n=new p).init({node:e,onStartPlayback:function(){m.start()},onStartQuantizedPlayback:function(){m.start("@1m")},onStopPlayback:function(){m.stop(),h.stopAll()},onPlay:t.onPlay,tempo:A(),onTempoChanged:function(e){g.updateTempo(e),N(),v()},showRecordButton:t.recorder,widgetId:t.widgetId}),(t.defaultState||t.tempo)&&((o=document.createElement("button")).innerHTML=t.lang["@reset"],o.className="widget-button widget-button--hidden",o.onclick=M,e.appendChild(o)),(u=document.createElement("button")).innerHTML=t.lang["@clear"],u.className="widget-button",u.style.marginLeft="auto",u.onclick=function(){g.clear()},e.appendChild(u),(f=document.createElement("button")).innerHTML=t.lang["@exporttolive"],f.className="btn btn--link btn--cropped",f.onclick=function(){if(!I())return f.style.pointerEvents="none",f.style.opacity=.25,void S("exportnotsupportedchromeios");f.style.pointerEvents="none",f.innerHTML=t.lang["@exporting"]+"...",y.trigger("export",y,(function(e){f.style.pointerEvents="initial",f.innerHTML=t.lang["@exporttolive"],e&&console.log(e)}))},"yes"!=t.disableExport&&(c.appendTooltippableChild(e,f),s.checkExportServiceAvailablility((function(e){f.style.opacity=e?1:.25,f.style.pointerEvents=e?"auto":"none"})))}(),(g=new C).init(t),g.bind("modelChange",(function(e){m.setModel(e),R(),N(),function(){if(u){var e=function(){var e=g?g.getModel():void 0;return!!e&&0<e.events.length}()?"":"widget-button--hidden";u.className="btn btn--link btn--cropped "+e}}(),v()})),g.bind("pageChange",(function(){!function(){if("takeover"==t.onPlay){h.stopAll();var e=g?g.getModel():void 0;e&&-1!=e.page?m.setLoop({start:4*e.page,end:4*e.page+4}):m.setLoop({start:0,end:t.beats})}}()})),g.bind("previewNotes",(function(e,t){!t&&n.isPlaying()||m.previewNotes(e)})),g.bind("tempoChanged",(function(e){n.setTempo(e),N(),v()})),m.bind("playNotes",(function(e){"tonal"==t.material?e.forEach((function(e){h.playNoteAtFrequency(e.lane.freq,e.time,e.length)})):"drums"==t.material&&h.playNotes(e)})),4===t.beats&&"drums"===t.material&&null==t.recorder&&function(){var e=document.createElement("div");e.className="widget-drumsequencer__column-labels";for(var n=0;n<16;n++){var o=document.createElement("div");o.className="widget-drumsequencer__column-label",n%4==0&&o.classList.add("widget-drumsequencer__column-label--beat"),o.innerHTML=n+1,e.appendChild(o)}document.getElementById(t.widgetId).appendChild(e)}(),t.defaultState&&M();var i=T(t.widgetId);i&&(i.tempo&&n.setTempo(i.tempo),g.setModel(i)),t.tip&&S(t.tip),d3.timer(k)}function S(e){function o(e){var n=t.tips[e];return n.name=e,n["@close"]=t.lang["@close"],n}switch(e){case"playstop":c.inject(n.playButton().parentElement,o(e),"100%","50%","left");break;case"record":c.inject(n.recordButton().parentElement,o(e));break;case"createdeletenotes":c.inject(g.getEditorTooltipWrapper(),o(e),"70%","60%");break;case"dragnotes":c.inject(g.getEditorTooltipWrapper(),o(e),"50%","55%");break;case"resizenotes":case"selectnotes":c.inject(g.getEditorTooltipWrapper(),o(e),"50%","65%");break;case"tempo":c.inject(g.getEditorTooltipWrapper(),o(e),"15%","50%");break;case"overview":c.inject(g.getEditorTooltipWrapper(),o(e),"30%","80%","right");break;case"export":I()&&c.inject(f.parentElement,o(e),"100%","50%","right");break;case"exportnotsupportedchromeios":c.inject(f.parentElement,o(e),"100%","50%","right")}}function I(){return!navigator.userAgent.match("CriOS")}function x(){var e=g.getModel();e&&(e.tempo=n.getTempo(),function(e,t,n){if(w("localStorage"))try{var o=e;o.version=n;var i=JSON.stringify(o);localStorage.setItem(t,i),window.arlan_ws&&window.arlan_received_state&&window.arlan_ws.send(JSON.stringify({type:"state",model:t,state:i}))}catch(e){return}}(e,t.widgetId,2))}function k(){var e=n.isPlaying()?m.progress():0;g.setPlayhead(e)}function M(){if(n.setTempo(A()),t.defaultState)g.setModel(JSON.parse(t.defaultState));else if(t.defaultRoot||t.defaultScale){var e=g.getModel();e.scaleName=t.defaultScale,e.rootName=t.defaultRoot,e.tempo=A(),g.setModel(e)}}function N(){if(o){var e=function(){var e=g?g.getModel():void 0;return t.defaultState?A()===n.getTempo()&&B(e)&&P.modelsMatch(JSON.parse(t.defaultState),g.getModel(),t.lanes.length):A()===n.getTempo()&&B(e)}()?"widget-button--hidden":"";o.className="btn btn--link btn--cropped "+e}}function R(){var e=document.getElementById(t.widgetId+"correct"),n=document.getElementById(t.widgetId+"generic");if(e&&n){var o=function(){var e=g?g.getModel():void 0;return!(!t.targetState||!e)&&("tonal"==t.material?P.modelsMatch(JSON.parse(t.targetState),g.getModel(),e.lanes.length):"drums"==t.material?P.populatedLanesMatch(JSON.parse(t.targetState),g.getModel(),e.lanes.length):void 0)}();e.className=o?"widget__dynamic-text":"widget__dynamic-text widget__dynamic-text--hidden",n.className=o?"widget__dynamic-text widget__dynamic-text--hidden":"widget__dynamic-text"}}function A(){return t.tempo?parseInt(t.tempo):85}function B(e){if(!e)return!0;var n=!t.defaultRoot||t.defaultRoot===e.rootName,o=!t.defaultScale||t.defaultScale===e.scaleName;return n&&o}function U(e){var o=t.lanes.map((function(e){return e.midi})),i=t.lanes.length-o.indexOf(e.midi)-1,r=m.progress()*t.beats;n.isRecording()&&n.isPlaying()&&(g.record({lane:i,start:r,duration:.25}),m.record({lane:i,start:r,duration:.25}))}};MicroEvent.mixin(k);window.SimpleSession=function(){var e,t,n,o,a,s,l,u;return this.init=function(p){i()?(e=p,o=document.getElementById(e.widgetId),(n=new d).init(e),Tone.Transport.bpm.value=e.preset.tempo,l="stopped",s=new Tone.MultiPlayer(function(e){var t={},n=h();return e.tracks.forEach((function(e,o){e.clips.forEach((function(e,o){var i=e.name;t[i]="./sounds/"+e.path+n}))})),t}(e.preset),(function(){!function(){n.onAudioLoaded(),SUPERVISOR.makeGestureOnElementResumeAudioContext(o),a=document.createElement("div"),c.appendTooltippableChild(o,a);for(var i=0;i<e.preset.tracks.length;i++){var r=e.preset.tracks[i];r.name=r["@name"]}t=Elm.SimpleSession.embed(a,e.preset),Tone.Transport.scheduleRepeat((function(e){t.ports.onTick.send(""+e)}),"1m"),t.ports.playSound.subscribe((function(t){var n=t[0],o=t[1];"stopped"==Tone.Transport.state&&(Tone.Transport.position="0:0:0",Tone.Transport.start("+0.1")),"stopped"==l&&(l="playing"),function(t,n){e.preset.tracks[n].clips.forEach((function(e){e.name!=t.name&&(Tone.Transport.clear(u[e.name]),Tone.Transport.scheduleOnce((function(t){try{s.stop(e.name,t)}catch(t){}}),"@1m"))}))}(n,o),u[n.name]=Tone.Transport.scheduleRepeat((function(t){try{s.stop(n.name,t)}catch(t){}s.start(n.name,t,0,n.length),SUPERVISOR.registerPlayingWidget(e.widgetId)}),n.length,"@1m")})),t.ports.unqueueSound.subscribe((function(e){Tone.Transport.clear(u[e.name])})),t.ports.stopSound.subscribe((function(e){Tone.Transport.clear(u[e.name]),Tone.Transport.scheduleOnce((function(t){try{s.stop(e.name,t)}catch(t){}}),"@1m")})),t.ports.allSoundsStopped.subscribe((function(t){SUPERVISOR.isOnlyWidgetPlaying(e.widgetId)&&(Tone.Transport.position="0:0:0",Tone.Transport.stop()),l="stopped",SUPERVISOR.unregisterPlayingWidget(e.widgetId)})),e.tip&&function(t){switch(t){case"devicemute":if(!b())return;c.inject(a,function(t){var n=e.tips[t];return n.name=t,n["@close"]=e.lang["@close"],n}(t),"65%","60%","right")}}(e.tip)}()})).toMaster(),u={}):r(document.getElementById(p.widgetId),p.lang["@incompatiblebrowser"])},this},window.SongFormExplorer=function(){var e,t,n;return this.init=function(i){n=i,t=document.getElementById(n.widgetId),function(){var i=document.createElement("div");t.appendChild(i);for(var r=0;r<n.preset.sections.length-1;r++){var a=n.preset.sections[r],s=n.preset.sections[r+1];a.end=s.start}for(n.preset.sections[n.preset.sections.length-1].end=n.preset.songLength,r=0;r<n.preset.sections.length;r++)(a=n.preset.sections[r]).description=a["@description"],a.name=a["@name"],a.label=a["@label"];for(r=0;r<n.preset.sections.length;r++)(a=n.preset.sections[r])["@label"]||(a.label=a.name);(e=Elm.SongFormExplorer.embed(i,n.preset)).ports.jumpToSection.subscribe((function(e){n.player.setPlayheadToTime(e.start)})),n.player.setPlayheadChangedCallback(o),n.tip&&function(e){switch(e){case"songformsections":t.style.position="relative",c.inject(t,function(e){var t=n.tips[e];return t.name=e,t["@close"]=n.lang["@close"],t}(e),"45px","65%")}}(n.tip)}()},this;function o(t){e.ports.updatePlayhead.send(t)}};YOUTUBEWIDGETS=[],YOUTUBE_API_READY=!1;window.YouTube=function(){var e,t,n,o,i,r,a,s,l=this;return l.init=function(i){e=i,n=document.getElementById(e.widgetId),(o=document.createElement("div")).className="widget-video__holder",o.id=e.widgetId+"video",o.style.display="none",n.appendChild(o),e.width&&(o.style.width=e.width+"px"),s=!1,(t=new d).init(e),YOUTUBE_API_READY?m():YOUTUBEWIDGETS.push(l)},l.onYouTubeIframeAPIReady=function(){m()},l.setPlayheadChangedCallback=function(e){a=e},l.setPlayheadToTime=function(t){void 0!==i&&void 0!==i.getPlayerState&&(i.getPlayerState()!=YT.PlayerState.PLAYING&&a&&a(t),i.seekTo(t),s&&i.playVideo(),Tone.Transport.emit("takeover",e.widgetId))},l;function u(n){t.hide(),document.getElementById(e.widgetId+"video").style.display="block",Tone.Transport.on("takeover",c),document.getElementById(e.widgetId).classList.add("is-ready")}function c(t){"takeover"==e.onPlay&&t!=e.widgetId&&i.getPlayerState()===YT.PlayerState.PLAYING&&(i.pauseVideo(),s=!0)}function p(){i&&i.getPlayerState()==YT.PlayerState.PLAYING&&a&&a(i.getCurrentTime())}function f(t){if(t.data==YT.PlayerState.PLAYING||t.data==YT.PlayerState.BUFFERING){var n=document.getElementById(e.widgetId);n.classList.remove("is-ready"),n.classList.add("is-playing")}t.data==YT.PlayerState.PLAYING?("takeover"==e.onPlay&&Tone.Transport.emit("takeover",e.widgetId),r?r.restart(p):r=d3.timer(p),SUPERVISOR.registerPlayingWidget(e.widgetId),s=!1):(SUPERVISOR.unregisterPlayingWidget(e.widgetId),r&&r.stop(p))}function m(){i=new YT.Player(e.widgetId+"video",{videoId:e.videoId,playerVars:{controls:2,disablekb:1,showinfo:0,color:"white",modestbranding:1,fs:0,playsinline:1,start:e.start?parseInt(e.start):0,end:e.end?parseInt(e.end):void 0,loop:e.loop&&"yes"===e.loop?1:0,host:"https://www.youtube-nocookie.com"},events:{onReady:u,onStateChange:f}})}}},{"lodash.throttle":"2EEuI"}],"2EEuI":[function(e,t,n){var o=arguments[3],i="Expected a function",r=NaN,a="[object Symbol]",s=/^\s+|\s+$/g,d=/^[-+]0x[0-9a-f]+$/i,l=/^0b[01]+$/i,u=/^0o[0-7]+$/i,c=parseInt,p="object"==typeof o&&o&&o.Object===Object&&o,f="object"==typeof self&&self&&self.Object===Object&&self,m=p||f||Function("return this")(),g=Object.prototype,h=g.toString,v=Math.max,w=Math.min,y=function(){return m.Date.now()};function T(e,t,n){var o,r,a,s,d,l,u=0,c=!1,p=!1,f=!0;if("function"!=typeof e)throw new TypeError(i);function m(t){var n=o,i=r;return o=r=void 0,u=t,s=e.apply(i,n)}function g(e){return u=e,d=setTimeout(T,t),c?m(e):s}function h(e){var n=e-l;return void 0===l||n>=t||n<0||p&&e-u>=a}function T(){var e=y();if(h(e))return b(e);d=setTimeout(T,function(e){var n=t-(e-l);return p?w(n,a-(e-u)):n}(e))}function b(e){return d=void 0,f&&o?m(e):(o=r=void 0,s)}function S(){var e=y(),n=h(e);if(o=arguments,r=this,l=e,n){if(void 0===d)return g(l);if(p)return d=setTimeout(T,t),m(l)}return void 0===d&&(d=setTimeout(T,t)),s}return t=_(t)||0,E(n)&&(c=!!n.leading,a=(p="maxWait"in n)?v(_(n.maxWait)||0,t):a,f="trailing"in n?!!n.trailing:f),S.cancel=function(){void 0!==d&&clearTimeout(d),u=0,o=l=r=d=void 0},S.flush=function(){return void 0===d?s:b(y())},S}function b(e,t,n){var o=!0,r=!0;if("function"!=typeof e)throw new TypeError(i);return E(n)&&(o="leading"in n?!!n.leading:o,r="trailing"in n?!!n.trailing:r),T(e,t,{leading:o,maxWait:t,trailing:r})}function E(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function S(e){return!!e&&"object"==typeof e}function I(e){return"symbol"==typeof e||S(e)&&h.call(e)==a}function _(e){if("number"==typeof e)return e;if(I(e))return r;if(E(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=E(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(s,"");var n=l.test(e);return n||u.test(e)?c(e.slice(2),n?2:8):d.test(e)?r:+e}t.exports=b},{}]},{},["1sJPi"]);
//# sourceMappingURL=index.807d2f47.js.map
